{"ast":null,"code":"var _jsxFileName = \"/Users/937bb/Documents/userProject/AutoPickup/admin-panel/src/components/ProductModal.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport * as yup from 'yup';\nimport toast from 'react-hot-toast';\nimport { XMarkIcon } from '@heroicons/react/24/outline';\nimport { productAPI, dictionaryAPI } from '../services/api';\nimport DictionarySelect from './DictionarySelect';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst schema = yup.object({\n  name: yup.string().required('请输入商品名称'),\n  description: yup.string().required('请输入商品描述'),\n  category: yup.string().required('请选择商品分类'),\n  price: yup.number().positive('价格必须大于0').required('请输入价格'),\n  stock: yup.number().integer('库存必须是整数').min(0, '库存不能小于0').required('请输入库存'),\n  deliveryType: yup.string().required('请选择发货类型'),\n  deliveryTemplate: yup.string().optional(),\n  deliveryData: yup.object().optional(),\n  // 添加发货数据字段\n  tags: yup.array().of(yup.string())\n});\nconst ProductModal = ({\n  isOpen,\n  onClose,\n  product,\n  onSave\n}) => {\n  _s();\n  const [loading, setLoading] = useState(false);\n  const [tags, setTags] = useState([]);\n  const [tagInput, setTagInput] = useState('');\n  const [images, setImages] = useState([]);\n  const [imagePreviewUrls, setImagePreviewUrls] = useState([]);\n  const [existingImages, setExistingImages] = useState([]);\n  const [imagesToRemove, setImagesToRemove] = useState([]);\n  const [deliveryTemplates, setDeliveryTemplates] = useState([]);\n  const [selectedTemplate, setSelectedTemplate] = useState(null);\n  const [templateFieldValues, setTemplateFieldValues] = useState({}); // 添加这行\n\n  const {\n    register,\n    handleSubmit,\n    formState: {\n      errors\n    },\n    reset,\n    watch,\n    setValue\n  } = useForm({\n    resolver: yupResolver(schema),\n    defaultValues: {\n      name: '',\n      description: '',\n      category: '',\n      price: 0,\n      stock: 0,\n      deliveryType: '',\n      deliveryTemplate: '',\n      tags: []\n    }\n  });\n  const deliveryType = watch('deliveryType');\n\n  // 渲染模板字段的函数（移到组件内部）\n  const renderTemplateField = field => {\n    const fieldValue = templateFieldValues[field.name] || field.defaultValue || '';\n    const updateFieldValue = value => {\n      setTemplateFieldValues(prev => ({\n        ...prev,\n        [field.name]: value\n      }));\n    };\n    switch (field.type) {\n      case 'text':\n      case 'url':\n      case 'number':\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"block text-sm font-medium text-gray-700 mb-1\",\n            children: [field.label, \" \", field.required && '*']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 84,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: field.type === 'number' ? 'number' : 'text',\n            value: fieldValue,\n            onChange: e => updateFieldValue(e.target.value),\n            placeholder: field.placeholder,\n            required: field.required,\n            className: \"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 87,\n            columnNumber: 13\n          }, this)]\n        }, field.name, true, {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 11\n        }, this);\n      case 'password':\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"block text-sm font-medium text-gray-700 mb-1\",\n            children: [field.label, \" \", field.required && '*']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 101,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"password\",\n            value: fieldValue,\n            onChange: e => updateFieldValue(e.target.value),\n            placeholder: field.placeholder,\n            required: field.required,\n            className: \"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 104,\n            columnNumber: 13\n          }, this)]\n        }, field.name, true, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 11\n        }, this);\n      case 'textarea':\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"block text-sm font-medium text-gray-700 mb-1\",\n            children: [field.label, \" \", field.required && '*']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 118,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            value: fieldValue,\n            onChange: e => updateFieldValue(e.target.value),\n            placeholder: field.placeholder,\n            required: field.required,\n            rows: 3,\n            className: \"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 121,\n            columnNumber: 13\n          }, this)]\n        }, field.name, true, {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 11\n        }, this);\n      case 'file':\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"block text-sm font-medium text-gray-700 mb-1\",\n            children: [field.label, \" \", field.required && '*']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 135,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            onChange: e => {\n              var _e$target$files;\n              const file = (_e$target$files = e.target.files) === null || _e$target$files === void 0 ? void 0 : _e$target$files[0];\n              if (file) {\n                updateFieldValue(file.name);\n              }\n            },\n            required: field.required,\n            className: \"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 138,\n            columnNumber: 13\n          }, this)]\n        }, field.name, true, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 11\n        }, this);\n      default:\n        return null;\n    }\n  };\n\n  // 获取发货模板\n  const fetchDeliveryTemplates = async deliveryType => {\n    try {\n      const response = await dictionaryAPI.getDeliveryTemplates(deliveryType);\n      if (response.data.success) {\n        setDeliveryTemplates(response.data.data);\n\n        // 编辑模式：优先使用产品的现有模板\n        if (product && product.deliveryTemplate) {\n          const existingTemplate = response.data.data.find(t => t.templateCode === product.deliveryTemplate);\n          if (existingTemplate) {\n            setSelectedTemplate(existingTemplate);\n            setValue('deliveryTemplate', existingTemplate.templateCode);\n            return;\n          }\n        }\n\n        // 新建模式或找不到现有模板时：使用默认模板\n        const defaultTemplate = response.data.data.find(t => t.isDefault);\n        if (defaultTemplate) {\n          setSelectedTemplate(defaultTemplate);\n          setValue('deliveryTemplate', defaultTemplate.templateCode);\n        }\n      }\n    } catch (error) {\n      console.error('获取发货模板失败:', error);\n    }\n  };\n\n  // 处理发货类型变化\n  const handleDeliveryTypeChange = (value, option) => {\n    setValue('deliveryType', value);\n    if (option) {\n      fetchDeliveryTemplates(option.value);\n    }\n  };\n  useEffect(() => {\n    if (product) {\n      var _product$categoryCode, _product$deliveryType, _product$deliveryType2;\n      reset({\n        name: product.name,\n        description: product.description,\n        category: ((_product$categoryCode = product.categoryCode) === null || _product$categoryCode === void 0 ? void 0 : _product$categoryCode.code) || product.category || '',\n        price: product.price,\n        stock: product.stock,\n        deliveryType: ((_product$deliveryType = product.deliveryTypeCode) === null || _product$deliveryType === void 0 ? void 0 : _product$deliveryType.code) || product.deliveryType || '',\n        deliveryTemplate: product.deliveryTemplate || '',\n        tags: product.tags || []\n      });\n      setTags(product.tags || []);\n      // 更健壮的图片数组处理\n      let imageArray = [];\n      if (product.images && Array.isArray(product.images)) {\n        imageArray = product.images;\n      } else if (product.images && typeof product.images === 'string') {\n        imageArray = [product.images];\n      } else {\n        console.warn('产品图片数据格式异常:', product.images);\n      }\n      console.log('最终设置的图片数组:', imageArray);\n      setExistingImages(imageArray);\n\n      // 如果产品有发货数据，设置模板字段值\n      if (product.deliveryData) {\n        setTemplateFieldValues(product.deliveryData);\n      }\n\n      // 如果有发货类型，获取对应的模板（这里会处理模板回显）\n      const deliveryTypeValue = ((_product$deliveryType2 = product.deliveryTypeCode) === null || _product$deliveryType2 === void 0 ? void 0 : _product$deliveryType2.code) || product.deliveryType;\n      if (deliveryTypeValue) {\n        fetchDeliveryTemplates(deliveryTypeValue);\n      }\n    } else {\n      reset({\n        name: '',\n        description: '',\n        category: '',\n        price: 0,\n        stock: 0,\n        deliveryType: '',\n        deliveryTemplate: '',\n        tags: []\n      });\n      setTags([]);\n      setExistingImages([]);\n      setTemplateFieldValues({});\n      setSelectedTemplate(null);\n      setDeliveryTemplates([]); // 添加这行，清空模板列表\n    }\n  }, [product, reset]);\n  const handleAddTag = () => {\n    if (tagInput.trim() && !tags.includes(tagInput.trim())) {\n      const newTags = [...tags, tagInput.trim()];\n      setTags(newTags);\n      setValue('tags', newTags);\n      setTagInput('');\n    }\n  };\n  const handleRemoveTag = tagToRemove => {\n    const newTags = tags.filter(tag => tag !== tagToRemove);\n    setTags(newTags);\n    setValue('tags', newTags);\n  };\n  const handleImageUpload = e => {\n    const files = Array.from(e.target.files || []);\n    const totalImages = images.length + existingImages.length;\n    if (totalImages + files.length > 5) {\n      toast.error('最多只能上传5张图片');\n      return;\n    }\n    setImages(prev => [...prev, ...files]);\n    files.forEach(file => {\n      const reader = new FileReader();\n      reader.onload = e => {\n        setImagePreviewUrls(prev => {\n          var _e$target;\n          return [...prev, (_e$target = e.target) === null || _e$target === void 0 ? void 0 : _e$target.result];\n        });\n      };\n      reader.readAsDataURL(file);\n    });\n  };\n  const removeNewImage = index => {\n    setImages(prev => prev.filter((_, i) => i !== index));\n    setImagePreviewUrls(prev => prev.filter((_, i) => i !== index));\n  };\n  const removeExistingImage = index => {\n    const imageToRemove = existingImages[index];\n    setImagesToRemove(prev => [...prev, imageToRemove]);\n    setExistingImages(prev => prev.filter((_, i) => i !== index));\n  };\n  const onSubmit = async data => {\n    try {\n      setLoading(true);\n      const formData = new FormData();\n\n      // 添加基本字段\n      Object.keys(data).forEach(key => {\n        if (key !== 'tags' && data[key] !== undefined) {\n          formData.append(key, String(data[key]));\n        }\n      });\n\n      // 添加标签\n      if (tags.length > 0) {\n        formData.append('tags', JSON.stringify(tags));\n      }\n\n      // 添加模板字段数据\n      if (selectedTemplate && Object.keys(templateFieldValues).length > 0) {\n        formData.append('deliveryData', JSON.stringify(templateFieldValues));\n      }\n\n      // 添加图片\n      images.forEach(image => {\n        formData.append('images', image);\n      });\n\n      // 添加要删除的图片\n      if (imagesToRemove.length > 0) {\n        formData.append('imagesToRemove', JSON.stringify(imagesToRemove));\n      }\n      let response;\n      if (product) {\n        response = await productAPI.updateProduct(product._id, formData);\n      } else {\n        response = await productAPI.createProduct(formData);\n      }\n      if (response.success) {\n        toast.success(product ? '商品更新成功' : '商品创建成功');\n        onSave();\n        onClose();\n      } else {\n        toast.error(response.message || '操作失败');\n      }\n    } catch (error) {\n      var _error$response, _error$response$data;\n      console.error('提交失败:', error);\n      toast.error(((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || '操作失败');\n    } finally {\n      setLoading(false);\n    }\n  };\n  if (!isOpen) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-2/3 xl:w-1/2 shadow-lg rounded-md bg-white\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-between items-center mb-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"text-lg font-medium text-gray-900\",\n            children: product ? '编辑商品' : '添加商品'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 357,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: onClose,\n            className: \"text-gray-400 hover:text-gray-600\",\n            children: /*#__PURE__*/_jsxDEV(XMarkIcon, {\n              className: \"w-6 h-6\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 364,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 360,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 356,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n          onSubmit: handleSubmit(onSubmit),\n          className: \"space-y-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-medium text-gray-700 mb-1\",\n              children: \"\\u5546\\u54C1\\u540D\\u79F0 *\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 371,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              ...register('name'),\n              className: `w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${errors.name ? 'border-red-500' : 'border-gray-300'}`,\n              placeholder: \"\\u8BF7\\u8F93\\u5165\\u5546\\u54C1\\u540D\\u79F0\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 374,\n              columnNumber: 15\n            }, this), errors.name && /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-red-500 text-sm mt-1\",\n              children: errors.name.message\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 383,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 370,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-medium text-gray-700 mb-1\",\n              children: \"\\u5546\\u54C1\\u63CF\\u8FF0 *\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 389,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n              ...register('description'),\n              rows: 4,\n              className: `w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${errors.description ? 'border-red-500' : 'border-gray-300'}`,\n              placeholder: \"\\u8BF7\\u8F93\\u5165\\u5546\\u54C1\\u63CF\\u8FF0\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 392,\n              columnNumber: 15\n            }, this), errors.description && /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-red-500 text-sm mt-1\",\n              children: errors.description.message\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 401,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 388,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-medium text-gray-700 mb-1\",\n              children: \"\\u5546\\u54C1\\u5206\\u7C7B *\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 407,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(DictionarySelect, {\n              typeCode: \"PRODUCT_CATEGORY\",\n              value: watch('category'),\n              onChange: value => setValue('category', value),\n              placeholder: \"\\u8BF7\\u9009\\u62E9\\u5546\\u54C1\\u5206\\u7C7B\",\n              className: errors.category ? 'border-red-500' : ''\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 410,\n              columnNumber: 15\n            }, this), errors.category && /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-red-500 text-sm mt-1\",\n              children: errors.category.message\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 418,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 406,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-medium text-gray-700 mb-1\",\n              children: \"\\u53D1\\u8D27\\u7C7B\\u578B *\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 424,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(DictionarySelect, {\n              typeCode: \"DELIVERY_TYPE\",\n              value: watch('deliveryType'),\n              onChange: handleDeliveryTypeChange,\n              placeholder: \"\\u8BF7\\u9009\\u62E9\\u53D1\\u8D27\\u7C7B\\u578B\",\n              className: errors.deliveryType ? 'border-red-500' : ''\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 427,\n              columnNumber: 15\n            }, this), errors.deliveryType && /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-red-500 text-sm mt-1\",\n              children: errors.deliveryType.message\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 435,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 423,\n            columnNumber: 13\n          }, this), deliveryTemplates.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-medium text-gray-700 mb-1\",\n              children: \"\\u53D1\\u8D27\\u6A21\\u677F\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 442,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              value: (selectedTemplate === null || selectedTemplate === void 0 ? void 0 : selectedTemplate.templateCode) || '',\n              onChange: e => {\n                const template = deliveryTemplates.find(t => t.templateCode === e.target.value);\n                setSelectedTemplate(template);\n                setValue('deliveryTemplate', e.target.value);\n                // 重置模板字段值\n                setTemplateFieldValues({});\n              },\n              className: \"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\",\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"\",\n                children: \"\\u8BF7\\u9009\\u62E9\\u53D1\\u8D27\\u6A21\\u677F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 456,\n                columnNumber: 19\n              }, this), deliveryTemplates.map(template => /*#__PURE__*/_jsxDEV(\"option\", {\n                value: template.templateCode,\n                children: template.templateName\n              }, template.templateCode, false, {\n                fileName: _jsxFileName,\n                lineNumber: 458,\n                columnNumber: 21\n              }, this))]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 445,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 441,\n            columnNumber: 15\n          }, this), selectedTemplate && selectedTemplate.fields && selectedTemplate.fields.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bg-gray-50 rounded-lg p-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n              className: \"text-sm font-medium text-gray-700 mb-3\",\n              children: \"\\u53D1\\u8D27\\u4FE1\\u606F\\u586B\\u5199\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 469,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"space-y-4\",\n              children: selectedTemplate.fields.map(field => renderTemplateField(field))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 470,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 468,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"grid grid-cols-2 gap-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"block text-sm font-medium text-gray-700 mb-1\",\n                children: \"\\u4EF7\\u683C *\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 479,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"number\",\n                step: \"0.01\",\n                ...register('price', {\n                  valueAsNumber: true\n                }),\n                className: `w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${errors.price ? 'border-red-500' : 'border-gray-300'}`,\n                placeholder: \"0.00\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 482,\n                columnNumber: 17\n              }, this), errors.price && /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-red-500 text-sm mt-1\",\n                children: errors.price.message\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 492,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 478,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"block text-sm font-medium text-gray-700 mb-1\",\n                children: \"\\u5E93\\u5B58 *\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 497,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"number\",\n                ...register('stock', {\n                  valueAsNumber: true\n                }),\n                className: `w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${errors.stock ? 'border-red-500' : 'border-gray-300'}`,\n                placeholder: \"0\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 500,\n                columnNumber: 17\n              }, this), errors.stock && /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-red-500 text-sm mt-1\",\n                children: errors.stock.message\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 509,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 496,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 477,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-medium text-gray-700 mb-2\",\n              children: \"\\u5546\\u54C1\\u56FE\\u7247 (\\u6700\\u591A5\\u5F20)\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 516,\n              columnNumber: 15\n            }, this), existingImages.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"block text-sm font-medium text-gray-700 mb-2\",\n                children: [\"\\u73B0\\u6709\\u56FE\\u7247 (\", existingImages.length, \"\\u5F20)\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 523,\n                columnNumber: 19\n              }, this), console.log('渲染时的existingImages:', existingImages), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"grid grid-cols-3 gap-2 mb-4\",\n                children: existingImages.map((image, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"relative group\",\n                  children: [console.log(`渲染图片 ${index}:`, image), /*#__PURE__*/_jsxDEV(\"img\", {\n                    src: `http://localhost:3001${image}`,\n                    alt: `现有图片 ${index + 1}`,\n                    className: \"w-full h-32 object-cover rounded-lg border border-gray-200\",\n                    onError: e => {\n                      console.error('图片加载失败，完整路径:', `http://localhost:3001${image}`);\n                      console.error('原始图片路径:', image);\n                      e.currentTarget.style.display = 'none';\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 532,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    type: \"button\",\n                    onClick: () => {\n                      setExistingImages(prev => prev.filter((_, i) => i !== index));\n                      setImagesToRemove(prev => [...prev, image]);\n                    },\n                    className: \"absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600\",\n                    children: \"\\xD7\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 542,\n                    columnNumber: 25\n                  }, this)]\n                }, index, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 530,\n                  columnNumber: 23\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 528,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 522,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 515,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-medium text-gray-700 mb-1\",\n              children: \"\\u5546\\u54C1\\u6807\\u7B7E\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 563,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex flex-wrap gap-2 mb-2\",\n              children: tags.map((tag, index) => /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800\",\n                children: [tag, /*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  onClick: () => handleRemoveTag(tag),\n                  className: \"ml-1 text-blue-600 hover:text-blue-800\",\n                  children: /*#__PURE__*/_jsxDEV(XMarkIcon, {\n                    className: \"w-3 h-3\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 578,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 573,\n                  columnNumber: 21\n                }, this)]\n              }, index, true, {\n                fileName: _jsxFileName,\n                lineNumber: 568,\n                columnNumber: 19\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 566,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex gap-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                value: tagInput,\n                onChange: e => setTagInput(e.target.value),\n                onKeyPress: e => e.key === 'Enter' && (e.preventDefault(), handleAddTag()),\n                className: \"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\",\n                placeholder: \"\\u8F93\\u5165\\u6807\\u7B7E\\u540E\\u6309\\u56DE\\u8F66\\u6DFB\\u52A0\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 584,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                onClick: handleAddTag,\n                className: \"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700\",\n                children: \"\\u6DFB\\u52A0\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 592,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 583,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 562,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex justify-end space-x-2 pt-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              onClick: onClose,\n              className: \"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50\",\n              children: \"\\u53D6\\u6D88\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 604,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              disabled: loading,\n              className: \"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50\",\n              children: loading ? '保存中...' : '保存'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 611,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 603,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 368,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 355,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 354,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 353,\n    columnNumber: 5\n  }, this);\n};\n_s(ProductModal, \"epWB0xTq8d6URhnmUcUsJ8lDXgg=\", false, function () {\n  return [useForm];\n});\n_c = ProductModal;\nexport default ProductModal;\nvar _c;\n$RefreshReg$(_c, \"ProductModal\");","map":{"version":3,"names":["React","useState","useEffect","useForm","yupResolver","yup","toast","XMarkIcon","productAPI","dictionaryAPI","DictionarySelect","jsxDEV","_jsxDEV","schema","object","name","string","required","description","category","price","number","positive","stock","integer","min","deliveryType","deliveryTemplate","optional","deliveryData","tags","array","of","ProductModal","isOpen","onClose","product","onSave","_s","loading","setLoading","setTags","tagInput","setTagInput","images","setImages","imagePreviewUrls","setImagePreviewUrls","existingImages","setExistingImages","imagesToRemove","setImagesToRemove","deliveryTemplates","setDeliveryTemplates","selectedTemplate","setSelectedTemplate","templateFieldValues","setTemplateFieldValues","register","handleSubmit","formState","errors","reset","watch","setValue","resolver","defaultValues","renderTemplateField","field","fieldValue","defaultValue","updateFieldValue","value","prev","type","children","className","label","fileName","_jsxFileName","lineNumber","columnNumber","onChange","e","target","placeholder","rows","_e$target$files","file","files","fetchDeliveryTemplates","response","getDeliveryTemplates","data","success","existingTemplate","find","t","templateCode","defaultTemplate","isDefault","error","console","handleDeliveryTypeChange","option","_product$categoryCode","_product$deliveryType","_product$deliveryType2","categoryCode","code","deliveryTypeCode","imageArray","Array","isArray","warn","log","deliveryTypeValue","handleAddTag","trim","includes","newTags","handleRemoveTag","tagToRemove","filter","tag","handleImageUpload","from","totalImages","length","forEach","reader","FileReader","onload","_e$target","result","readAsDataURL","removeNewImage","index","_","i","removeExistingImage","imageToRemove","onSubmit","formData","FormData","Object","keys","key","undefined","append","String","JSON","stringify","image","updateProduct","_id","createProduct","message","_error$response","_error$response$data","onClick","typeCode","template","map","templateName","fields","step","valueAsNumber","src","alt","onError","currentTarget","style","display","onKeyPress","preventDefault","disabled","_c","$RefreshReg$"],"sources":["/Users/937bb/Documents/userProject/AutoPickup/admin-panel/src/components/ProductModal.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { useForm, SubmitHandler } from 'react-hook-form';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport * as yup from 'yup';\nimport toast from 'react-hot-toast';\nimport { PhotoIcon, XMarkIcon } from '@heroicons/react/24/outline';\nimport { productAPI, dictionaryAPI } from '../services/api';\nimport { Product, ProductFormData } from '../types';\nimport DictionarySelect from './DictionarySelect';\n\nconst schema = yup.object({\n  name: yup.string().required('请输入商品名称'),\n  description: yup.string().required('请输入商品描述'),\n  category: yup.string().required('请选择商品分类'),\n  price: yup.number().positive('价格必须大于0').required('请输入价格'),\n  stock: yup.number().integer('库存必须是整数').min(0, '库存不能小于0').required('请输入库存'),\n  deliveryType: yup.string().required('请选择发货类型'),\n  deliveryTemplate: yup.string().optional(),\n  deliveryData: yup.object().optional(), // 添加发货数据字段\n  tags: yup.array().of(yup.string()),\n});\n\ntype FormData = yup.InferType<typeof schema>;\n\ninterface ProductModalProps {\n  isOpen: boolean;\n  product?: Product | null;\n  onClose: () => void;\n  onSave: () => void;\n}\n\nconst ProductModal: React.FC<ProductModalProps> = ({ isOpen, onClose, product, onSave }) => {\n  const [loading, setLoading] = useState(false);\n  const [tags, setTags] = useState<string[]>([]);\n  const [tagInput, setTagInput] = useState('');\n  const [images, setImages] = useState<File[]>([]);\n  const [imagePreviewUrls, setImagePreviewUrls] = useState<string[]>([]);\n  const [existingImages, setExistingImages] = useState<string[]>([]);\n  const [imagesToRemove, setImagesToRemove] = useState<string[]>([]);\n  const [deliveryTemplates, setDeliveryTemplates] = useState<any[]>([]);\n  const [selectedTemplate, setSelectedTemplate] = useState<any>(null);\n  const [templateFieldValues, setTemplateFieldValues] = useState<Record<string, any>>({}); // 添加这行\n\n  const {\n    register,\n    handleSubmit,\n    formState: { errors },\n    reset,\n    watch,\n    setValue,\n  } = useForm<FormData>({\n    resolver: yupResolver(schema),\n    defaultValues: {\n      name: '',\n      description: '',\n      category: '',\n      price: 0,\n      stock: 0,\n      deliveryType: '',\n      deliveryTemplate: '',\n      tags: [],\n    },\n  });\n\n  const deliveryType = watch('deliveryType');\n\n  // 渲染模板字段的函数（移到组件内部）\n  const renderTemplateField = (field: any) => {\n    const fieldValue = templateFieldValues[field.name] || field.defaultValue || '';\n    \n    const updateFieldValue = (value: any) => {\n      setTemplateFieldValues((prev: Record<string, any>) => ({\n        ...prev,\n        [field.name]: value\n      }));\n    };\n\n    switch (field.type) {\n      case 'text':\n      case 'url':\n      case 'number':\n        return (\n          <div key={field.name}>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              {field.label} {field.required && '*'}\n            </label>\n            <input\n              type={field.type === 'number' ? 'number' : 'text'}\n              value={fieldValue}\n              onChange={(e) => updateFieldValue(e.target.value)}\n              placeholder={field.placeholder}\n              required={field.required}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n        );\n      \n      case 'password':\n        return (\n          <div key={field.name}>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              {field.label} {field.required && '*'}\n            </label>\n            <input\n              type=\"password\"\n              value={fieldValue}\n              onChange={(e) => updateFieldValue(e.target.value)}\n              placeholder={field.placeholder}\n              required={field.required}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n        );\n      \n      case 'textarea':\n        return (\n          <div key={field.name}>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              {field.label} {field.required && '*'}\n            </label>\n            <textarea\n              value={fieldValue}\n              onChange={(e) => updateFieldValue(e.target.value)}\n              placeholder={field.placeholder}\n              required={field.required}\n              rows={3}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n        );\n      \n      case 'file':\n        return (\n          <div key={field.name}>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              {field.label} {field.required && '*'}\n            </label>\n            <input\n              type=\"file\"\n              onChange={(e) => {\n                const file = e.target.files?.[0];\n                if (file) {\n                  updateFieldValue(file.name);\n                }\n              }}\n              required={field.required}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n        );\n      \n      default:\n        return null;\n    }\n  };\n\n  // 获取发货模板\n  const fetchDeliveryTemplates = async (deliveryType: string) => {\n    try {\n      const response = await dictionaryAPI.getDeliveryTemplates(deliveryType);\n      if (response.data.success) {\n        setDeliveryTemplates(response.data.data);\n        \n        // 编辑模式：优先使用产品的现有模板\n        if (product && product.deliveryTemplate) {\n          const existingTemplate = response.data.data.find((t: any) => t.templateCode === product.deliveryTemplate);\n          if (existingTemplate) {\n            setSelectedTemplate(existingTemplate);\n            setValue('deliveryTemplate', existingTemplate.templateCode);\n            return;\n          }\n        }\n        \n        // 新建模式或找不到现有模板时：使用默认模板\n        const defaultTemplate = response.data.data.find((t: any) => t.isDefault);\n        if (defaultTemplate) {\n          setSelectedTemplate(defaultTemplate);\n          setValue('deliveryTemplate', defaultTemplate.templateCode);\n        }\n      }\n    } catch (error) {\n      console.error('获取发货模板失败:', error);\n    }\n  };\n\n  // 处理发货类型变化\n  const handleDeliveryTypeChange = (value: string, option?: any) => {\n    setValue('deliveryType', value);\n    if (option) {\n      fetchDeliveryTemplates(option.value);\n    }\n  };\n\n  useEffect(() => {\n    if (product) {\n      reset({\n        name: product.name,\n        description: product.description,\n        category: product.categoryCode?.code || product.category || '',\n        price: product.price,\n        stock: product.stock,\n        deliveryType: product.deliveryTypeCode?.code || product.deliveryType || '',\n        deliveryTemplate: product.deliveryTemplate || '',\n        tags: product.tags || [],\n      });\n      setTags(product.tags || []);\n      // 更健壮的图片数组处理\n      let imageArray = [];\n      if (product.images && Array.isArray(product.images)) {\n        imageArray = product.images;\n      } else if (product.images && typeof product.images === 'string') {\n        imageArray = [product.images];\n      } else {\n        console.warn('产品图片数据格式异常:', product.images);\n      }\n      \n      console.log('最终设置的图片数组:', imageArray);\n      setExistingImages(imageArray);\n      \n      // 如果产品有发货数据，设置模板字段值\n      if (product.deliveryData) {\n        setTemplateFieldValues(product.deliveryData);\n      }\n      \n      // 如果有发货类型，获取对应的模板（这里会处理模板回显）\n      const deliveryTypeValue = product.deliveryTypeCode?.code || product.deliveryType;\n      if (deliveryTypeValue) {\n        fetchDeliveryTemplates(deliveryTypeValue);\n      }\n    } else {\n      reset({\n        name: '',\n        description: '',\n        category: '',\n        price: 0,\n        stock: 0,\n        deliveryType: '',\n        deliveryTemplate: '',\n        tags: [],\n      });\n      setTags([]);\n      setExistingImages([]);\n      setTemplateFieldValues({});\n      setSelectedTemplate(null);\n      setDeliveryTemplates([]); // 添加这行，清空模板列表\n    }\n  }, [product, reset]);\n\n  const handleAddTag = () => {\n    if (tagInput.trim() && !tags.includes(tagInput.trim())) {\n      const newTags = [...tags, tagInput.trim()];\n      setTags(newTags);\n      setValue('tags', newTags);\n      setTagInput('');\n    }\n  };\n\n  const handleRemoveTag = (tagToRemove: string) => {\n    const newTags = tags.filter(tag => tag !== tagToRemove);\n    setTags(newTags);\n    setValue('tags', newTags);\n  };\n\n  const handleImageUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(e.target.files || []);\n    const totalImages = images.length + existingImages.length;\n    \n    if (totalImages + files.length > 5) {\n      toast.error('最多只能上传5张图片');\n      return;\n    }\n\n    setImages(prev => [...prev, ...files]);\n    \n    files.forEach(file => {\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        setImagePreviewUrls(prev => [...prev, e.target?.result as string]);\n      };\n      reader.readAsDataURL(file);\n    });\n  };\n\n  const removeNewImage = (index: number) => {\n    setImages(prev => prev.filter((_, i) => i !== index));\n    setImagePreviewUrls(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const removeExistingImage = (index: number) => {\n    const imageToRemove = existingImages[index];\n    setImagesToRemove(prev => [...prev, imageToRemove]);\n    setExistingImages(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const onSubmit: SubmitHandler<FormData> = async (data) => {\n    try {\n      setLoading(true);\n      \n      const formData = new FormData();\n      \n      // 添加基本字段\n      Object.keys(data).forEach(key => {\n        if (key !== 'tags' && data[key as keyof FormData] !== undefined) {\n          formData.append(key, String(data[key as keyof FormData]));\n        }\n      });\n      \n      // 添加标签\n      if (tags.length > 0) {\n        formData.append('tags', JSON.stringify(tags));\n      }\n      \n      // 添加模板字段数据\n      if (selectedTemplate && Object.keys(templateFieldValues).length > 0) {\n        formData.append('deliveryData', JSON.stringify(templateFieldValues));\n      }\n      \n      // 添加图片\n      images.forEach((image) => {\n        formData.append('images', image);\n      });\n      \n      // 添加要删除的图片\n      if (imagesToRemove.length > 0) {\n        formData.append('imagesToRemove', JSON.stringify(imagesToRemove));\n      }\n      \n      let response;\n      if (product) {\n        response = await productAPI.updateProduct(product._id, formData);\n      } else {\n        response = await productAPI.createProduct(formData);\n      }\n      \n      if (response.success) {\n        toast.success(product ? '商品更新成功' : '商品创建成功');\n        onSave();\n        onClose();\n      } else {\n        toast.error(response.message || '操作失败');\n      }\n    } catch (error: any) {\n      console.error('提交失败:', error);\n      toast.error(error.response?.data?.message || '操作失败');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50\">\n      <div className=\"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-2/3 xl:w-1/2 shadow-lg rounded-md bg-white\">\n        <div className=\"mt-3\">\n          <div className=\"flex justify-between items-center mb-6\">\n            <h3 className=\"text-lg font-medium text-gray-900\">\n              {product ? '编辑商品' : '添加商品'}\n            </h3>\n            <button\n              onClick={onClose}\n              className=\"text-gray-400 hover:text-gray-600\"\n            >\n              <XMarkIcon className=\"w-6 h-6\" />\n            </button>\n          </div>\n\n          <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-6\">\n            {/* 商品名称 */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                商品名称 *\n              </label>\n              <input\n                type=\"text\"\n                {...register('name')}\n                className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${\n                  errors.name ? 'border-red-500' : 'border-gray-300'\n                }`}\n                placeholder=\"请输入商品名称\"\n              />\n              {errors.name && (\n                <p className=\"text-red-500 text-sm mt-1\">{errors.name.message}</p>\n              )}\n            </div>\n\n            {/* 商品描述 */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                商品描述 *\n              </label>\n              <textarea\n                {...register('description')}\n                rows={4}\n                className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${\n                  errors.description ? 'border-red-500' : 'border-gray-300'\n                }`}\n                placeholder=\"请输入商品描述\"\n              />\n              {errors.description && (\n                <p className=\"text-red-500 text-sm mt-1\">{errors.description.message}</p>\n              )}\n            </div>\n\n            {/* 商品分类 */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                商品分类 *\n              </label>\n              <DictionarySelect\n                typeCode=\"PRODUCT_CATEGORY\"\n                value={watch('category')}\n                onChange={(value) => setValue('category', value)}\n                placeholder=\"请选择商品分类\"\n                className={errors.category ? 'border-red-500' : ''}\n              />\n              {errors.category && (\n                <p className=\"text-red-500 text-sm mt-1\">{errors.category.message}</p>\n              )}\n            </div>\n\n            {/* 发货类型 */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                发货类型 *\n              </label>\n              <DictionarySelect\n                typeCode=\"DELIVERY_TYPE\"\n                value={watch('deliveryType')}\n                onChange={handleDeliveryTypeChange}\n                placeholder=\"请选择发货类型\"\n                className={errors.deliveryType ? 'border-red-500' : ''}\n              />\n              {errors.deliveryType && (\n                <p className=\"text-red-500 text-sm mt-1\">{errors.deliveryType.message}</p>\n              )}\n            </div>\n\n            {/* 发货模板选择 */}\n            {deliveryTemplates.length > 0 && (\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  发货模板\n                </label>\n                <select\n                  value={selectedTemplate?.templateCode || ''}\n                  onChange={(e) => {\n                    const template = deliveryTemplates.find(t => t.templateCode === e.target.value);\n                    setSelectedTemplate(template);\n                    setValue('deliveryTemplate', e.target.value);\n                    // 重置模板字段值\n                    setTemplateFieldValues({});\n                  }}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                >\n                  <option value=\"\">请选择发货模板</option>\n                  {deliveryTemplates.map((template) => (\n                    <option key={template.templateCode} value={template.templateCode}>\n                      {template.templateName}\n                    </option>\n                  ))}\n                </select>\n              </div>\n            )}\n\n            {/* 模板字段填写区域 */}\n            {selectedTemplate && selectedTemplate.fields && selectedTemplate.fields.length > 0 && (\n              <div className=\"bg-gray-50 rounded-lg p-4\">\n                <h4 className=\"text-sm font-medium text-gray-700 mb-3\">发货信息填写</h4>\n                <div className=\"space-y-4\">\n                  {selectedTemplate.fields.map((field: any) => renderTemplateField(field))}\n                </div>\n              </div>\n            )}\n\n            {/* 价格和库存 */}\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  价格 *\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.01\"\n                  {...register('price', { valueAsNumber: true })}\n                  className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${\n                    errors.price ? 'border-red-500' : 'border-gray-300'\n                  }`}\n                  placeholder=\"0.00\"\n                />\n                {errors.price && (\n                  <p className=\"text-red-500 text-sm mt-1\">{errors.price.message}</p>\n                )}\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  库存 *\n                </label>\n                <input\n                  type=\"number\"\n                  {...register('stock', { valueAsNumber: true })}\n                  className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${\n                    errors.stock ? 'border-red-500' : 'border-gray-300'\n                  }`}\n                  placeholder=\"0\"\n                />\n                {errors.stock && (\n                  <p className=\"text-red-500 text-sm mt-1\">{errors.stock.message}</p>\n                )}\n              </div>\n            </div>\n\n            {/* 商品图片 */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                商品图片 (最多5张)\n              </label>\n              \n              {/* 现有图片显示 */}\n              {existingImages.length > 0 && (\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    现有图片 ({existingImages.length}张)\n                  </label>\n                  {/* 添加调试信息 */}\n                  {console.log('渲染时的existingImages:', existingImages)}\n                  <div className=\"grid grid-cols-3 gap-2 mb-4\">\n                    {existingImages.map((image, index) => (\n                      <div key={index} className=\"relative group\">\n                        {console.log(`渲染图片 ${index}:`, image)}\n                        <img\n                          src={`http://localhost:3001${image}`}\n                          alt={`现有图片 ${index + 1}`}\n                          className=\"w-full h-32 object-cover rounded-lg border border-gray-200\"\n                          onError={(e) => {\n                            console.error('图片加载失败，完整路径:', `http://localhost:3001${image}`);\n                            console.error('原始图片路径:', image);\n                            e.currentTarget.style.display = 'none';\n                          }}\n                        />\n                        <button\n                          type=\"button\"\n                          onClick={() => {\n                            setExistingImages(prev => prev.filter((_, i) => i !== index));\n                            setImagesToRemove(prev => [...prev, image]);\n                          }}\n                          className=\"absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600\"\n                        >\n                          ×\n                        </button>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n              \n              {/* 上传新图片的现有代码... */}\n            </div>\n\n            {/* 标签 */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                商品标签\n              </label>\n              <div className=\"flex flex-wrap gap-2 mb-2\">\n                {tags.map((tag, index) => (\n                  <span\n                    key={index}\n                    className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800\"\n                  >\n                    {tag}\n                    <button\n                      type=\"button\"\n                      onClick={() => handleRemoveTag(tag)}\n                      className=\"ml-1 text-blue-600 hover:text-blue-800\"\n                    >\n                      <XMarkIcon className=\"w-3 h-3\" />\n                    </button>\n                  </span>\n                ))}\n              </div>\n              <div className=\"flex gap-2\">\n                <input\n                  type=\"text\"\n                  value={tagInput}\n                  onChange={(e) => setTagInput(e.target.value)}\n                  onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), handleAddTag())}\n                  className=\"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\"输入标签后按回车添加\"\n                />\n                <button\n                  type=\"button\"\n                  onClick={handleAddTag}\n                  className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700\"\n                >\n                  添加\n                </button>\n              </div>\n            </div>\n\n            {/* 提交按钮 */}\n            <div className=\"flex justify-end space-x-2 pt-4\">\n              <button\n                type=\"button\"\n                onClick={onClose}\n                className=\"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50\"\n              >\n                取消\n              </button>\n              <button\n                type=\"submit\"\n                disabled={loading}\n                className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50\"\n              >\n                {loading ? '保存中...' : '保存'}\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ProductModal;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}